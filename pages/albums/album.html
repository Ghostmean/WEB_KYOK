<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–ª—å–±–æ–º - –ö–£–û–ö</title>
    <link rel="stylesheet" href="../../css/styles.css">
    <link rel="stylesheet" href="../../css/album.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="../../js/script.js" defer></script>
</head>

<body class="light-theme">
    <nav class="navbar">
        <div class="container navbar-container">
            <div class="logo">–ö–£–û–ö</div>
            <ul class="nav-links">
                <li><a href="../../index.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="../../index.html#artist">–û–± –∞—Ä—Ç–∏—Å—Ç–µ</a></li>
                <li><a href="../../index.html#top-tracks">–¢–æ–ø —Ç—Ä–µ–∫–∏</a></li>
                <li><a href="../../index.html#albums">–ê–ª—å–±–æ–º—ã</a></li>
                <li><a href="../../index.html#singles">–°–∏–Ω–≥–ª—ã</a></li>
            </ul>
            <div class="theme-toggle">
                <span class="theme-label">–¢–µ–º–∞:</span>
                <button id="theme-toggle-btn" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                    <span class="toggle-icon">üåô</span>
                </button>
            </div>
        </div>
    </nav>

    <main class="album-page">
        <div class="album-container">
            <div class="album-header">
                <div class="album-cover-large">
                    <img id="album-cover" src="" alt="Album Cover">
                </div>
                <div class="album-info-large">
                    <h1 id="album-title"></h1>
                    <p id="album-artist"></p>
                    <div class="album-meta-large">
                        <span id="album-year"></span>
                        <span id="album-listens"></span>
                    </div>
                </div>
            </div>

            <div class="tracks-section">
                <h2>–¢—Ä–µ–∫–∏</h2>
                <div id="tracks-list" class="tracks-list"></div>
            </div>
        </div>
    </main>

    <script>
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∞–ª—å–±–æ–º–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', async() => {
            const urlParams = new URLSearchParams(window.location.search);
            const albumId = urlParams.get('id');

            if (albumId) {
                try {
                    // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage
                    let albumData = JSON.parse(localStorage.getItem('currentAlbum'));

                    // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –≤ localStorage, –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ JSON
                    if (!albumData) {
                        const response = await fetch('../../data/albums.json');
                        if (!response.ok) {
                            throw new Error('Failed to load album data');
                        }
                        const data = await response.json();
                        albumData = data.albums.find(a => a.id === albumId);
                    }

                    if (albumData) {
                        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–∞–Ω–Ω—ã–º–∏ –∞–ª—å–±–æ–º–∞
                        document.title = `${albumData.title} - –ö–£–û–ö`;
                        document.getElementById('album-cover').src = albumData.cover;
                        document.getElementById('album-title').textContent = albumData.title;
                        document.getElementById('album-artist').textContent = albumData.artist;
                        document.getElementById('album-year').textContent = albumData.year;
                        document.getElementById('album-listens').textContent =
                            `${formatListens(albumData.listens)} –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–π`;

                        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫–æ–≤
                        const tracksList = document.getElementById('tracks-list');
                        if (albumData.tracks) {
                            albumData.tracks.forEach(track => {
                                const trackElement = document.createElement('div');
                                trackElement.className = 'track-item';
                                trackElement.innerHTML = `
                                    <div class="track-position">
                                        <span class="position-number">${track.number}</span>
                                    </div>
                                    <div class="track-info">
                                        <h4 class="track-title">${track.title}</h4>
                                    </div>
                                    <div class="track-duration">
                                        <i class="fas fa-clock"></i>
                                        <span>${track.duration}</span>
                                    </div>
                                `;
                                tracksList.appendChild(trackElement);
                            });
                        }
                    } else {
                        throw new Error('Album not found');
                    }
                } catch (error) {
                    console.error('Error loading album:', error);
                    showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∞–ª—å–±–æ–º–∞');
                    setTimeout(() => {
                        window.location.href = '../../index.html';
                    }, 2000);
                }
            } else {
                showNotification('ID –∞–ª—å–±–æ–º–∞ –Ω–µ —É–∫–∞–∑–∞–Ω');
                setTimeout(() => {
                    window.location.href = '../../index.html';
                }, 2000);
            }
        });
    </script>
</body>

</html>