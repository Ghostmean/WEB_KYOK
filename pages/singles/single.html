<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏–Ω–≥–ª - –ö–£–û–ö</title>
    <link rel="stylesheet" href="/WEB_KYOK/css/styles.css">
    <link rel="stylesheet" href="/WEB_KYOK/css/single.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="/WEB_KYOK/js/script.js" defer></script>
</head>

<body class="light-theme">
    <nav class="navbar">
        <div class="container navbar-container">
            <div class="logo">–ö–£–û–ö</div>
            <ul class="nav-links">
                <li><a href="/WEB_KYOK/index.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="/WEB_KYOK/index.html#artist">–û–± –∞—Ä—Ç–∏—Å—Ç–µ</a></li>
                <li><a href="/WEB_KYOK/index.html#top-tracks">–¢–æ–ø —Ç—Ä–µ–∫–∏</a></li>
                <li><a href="/WEB_KYOK/index.html#albums">–ê–ª—å–±–æ–º—ã</a></li>
                <li><a href="/WEB_KYOK/index.html#singles">–°–∏–Ω–≥–ª—ã</a></li>
            </ul>
            <div class="theme-toggle">
                <span class="theme-label">–¢–µ–º–∞:</span>
                <button id="theme-toggle-btn" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                    <span class="toggle-icon">üåô</span>
                </button>
            </div>
        </div>
    </nav>

    <main class="album-page">
        <div class="album-container">
            <div class="album-header">
                <div class="album-cover-large">
                    <img id="album-cover" src="" alt="Single Cover">
                </div>
                <div class="album-info-large">
                    <h1 id="album-title"></h1>
                    <p id="album-artist"></p>
                    <div class="album-meta-large">
                        <span id="album-year"></span>
                        <span id="album-listens"></span>
                    </div>
                </div>
            </div>

            <div class="tracks-section">
                <h2>–¢—Ä–µ–∫–∏</h2>
                <div id="tracks-list" class="tracks-list"></div>
            </div>
        </div>
    </main>

    <script>
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–∏–Ω–≥–ª–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', async() => {
            const urlParams = new URLSearchParams(window.location.search);
            const singleId = urlParams.get('id');

            if (singleId) {
                try {
                    // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage
                    let singleData = JSON.parse(localStorage.getItem('currentSingle'));

                    // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –≤ localStorage, –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ JSON
                    if (!singleData) {
                        const response = await fetch('/WEB_KYOK/data/singles.json');
                        if (!response.ok) {
                            throw new Error('Failed to load single data');
                        }
                        const data = await response.json();
                        singleData = data.singles.find(s => s.id === singleId);
                    }

                    if (singleData) {
                        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–∞–Ω–Ω—ã–º–∏ —Å–∏–Ω–≥–ª–∞
                        document.title = `${singleData.title} - –ö–£–û–ö`;
                        document.getElementById('album-cover').src = singleData.cover;
                        document.getElementById('album-title').textContent = singleData.title;
                        document.getElementById('album-artist').textContent = singleData.artist;
                        document.getElementById('album-year').textContent = singleData.year;
                        document.getElementById('album-listens').textContent =
                            `${formatListens(singleData.listens)} –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–π`;

                        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç—Ä–µ–∫
                        const tracksList = document.getElementById('tracks-list');
                        const trackElement = document.createElement('div');
                        trackElement.className = 'track-item';
                        trackElement.innerHTML = `
                            <div class="track-position">
                                <span class="position-number">1</span>
                            </div>
                            <div class="track-info">
                                <h4 class="track-title">${singleData.title}</h4>
                            </div>
                            <div class="track-duration">
                                <i class="fas fa-clock"></i>
                                <span>${singleData.duration}</span>
                            </div>
                        `;
                        tracksList.appendChild(trackElement);
                    } else {
                        throw new Error('Single not found');
                    }
                } catch (error) {
                    console.error('Error loading single:', error);
                    showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å–∏–Ω–≥–ª–∞');
                    setTimeout(() => {
                        window.location.href = '/WEB_KYOK/index.html';
                    }, 2000);
                }
            } else {
                showNotification('ID —Å–∏–Ω–≥–ª–∞ –Ω–µ —É–∫–∞–∑–∞–Ω');
                setTimeout(() => {
                    window.location.href = '/WEB_KYOK/index.html';
                }, 2000);
            }
        });
    </script>
</body>

</html>